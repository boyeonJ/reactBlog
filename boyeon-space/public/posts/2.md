
# React Queryì˜ ìºì‹œ ìƒíƒœ(fresh, stale, inactive)

react query deevtoolì„ ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì´ **fresh, stale, fetching, inactive**ë¼ëŠ” ìƒíƒœê°€ ì¡´ìž¬í•©ë‹ˆë‹¤.
![mdx](https://velog.velcdn.com/images/boyeon_jeong/post/0bf44066-16bd-46e6-9b31-f8319aaa0697/image.png)

> **fresh**(:ì‹ ì„ í•œ) > ë°ì´í„° ê·¸ëŒ€ë¡œ ì‚¬ìš© ê°€ëŠ¥(í˜„ìž¬ DB ì €ìž¥ëœ ë°ì´í„°ì™€ ê°™ì€ ë°ì´í„°)
**stale**(:ì‹ ì„ í•˜ì§€ ì•Šì€) > ë°ì´í„° ìƒˆë¡œ fetching í•„ìš”(í˜„ìž¬ DB ì €ìž¥ëœ ë°ì´í„°ì™€ ë‹¤ë¥¸ ë°ì´í„°)
**inactive** > í˜„ìž¬ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš© x

ê°€ìž¥ ë¨¼ì € react queryì—ì„œ `ìºì‹œê°€ ìœ íš¨í•˜ë‹¤`ë¼ëŠ” ë§ì€ QueryCache ê°ì²´ì˜ **queries ë°°ì—´ê³¼ queriesInMap ê°ì²´**ì— ë°ì´í„°ê°€ `ì €ìž¥ë˜ì–´ ìžˆëŠ” ìƒíƒœ`ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤. 

ê¸°ë³¸ì ìœ¼ë¡œ ìœ„ì˜ 3ê°€ì§€ ìƒíƒœ(fresh, stale, inactive)ëŠ” `ëª¨ë‘ ì €ìž¥ì€ ë˜ì–´ìžˆëŠ” ë°ì´í„°(ìºì‹± ë°ì´í„°)`ì´ë©°, ì•„ëž˜ 2ê°€ì§€ì˜ ìƒí™©ì— ë”°ë¼ `ìƒíƒœë¥¼ êµ¬ë³„`í•œ ê²ƒìž…ë‹ˆë‹¤.
1. í˜„ìž¬ ì»´í¬ë„ŒíŠ¸ ì‚¬ìš©ë˜ëŠ”ì§€ ìœ ë¬´
2. refectcingì´ í•„ìš”í•œì§€
![mdx](https://velog.velcdn.com/images/boyeon_jeong/post/a5aa06d7-cd7e-4964-8cff-175d6bb2c9b1/image.png)


ë§Œì•½ ì´ ìºì‹œê°€ í˜„ìž¬ DB ì €ìž¥ëœ ë°ì´í„°ì™€ ê°™ì•„ì„œ ê·¸ëŒ€ë¡œ ì‚¬ìš© ê°€ëŠ¥í•œ ê²½ìš°ë¼ë©´ apië¥¼ ìƒˆë¡œ refectcingí•˜ì§€ ì•Šì•„ë„ ë˜ëŠ” `fresh` ìƒíƒœë¥¼ ì˜ë¯¸í•˜ê³ , DB ë°ì´í„°ê°€ ìƒˆë¡œ ì—…ë°ì´íŠ¸ ë˜ì–´ refectcingì´ í•„ìš”í•œ `stale` ìƒíƒœë¼ê³  í•©ë‹ˆë‹¤.

ë”°ë¼ì„œ staleì¼ ê²½ìš°ì— refectcingì´ ë˜ëŠ”ë°ìš”. ì—¬ê¸°ì„œ **ë¬´ì¡°ê±´ staleë¼ê³  í•´ì„œ ì‹¤ì‹œê°„ìœ¼ë¡œ apiê°€ refectcing ë˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼** ì•„ëž˜ì™€ ê°™ì€ ìƒí™©ì¼ ê²½ìš° refectcingì´ ì§„í–‰ë©ë‹ˆë‹¤.
- ìƒˆë¡œìš´ Query Instanceê°€ ë§ˆìš´íŠ¸ ë  ë•Œ (íŽ˜ì´ì§€ ì´ë™ í›„ ë“±ì˜ ìƒí™©)
- ë¸Œë¼ìš°ì € í™”ë©´ì„ ë‹¤ì‹œ focus í•  ë•Œ
- ì¸í„°ë„·ì´ ìž¬ì—°ê²°ë˜ì—ˆì„ ë•Œ
- refetchIntervalì´ ì„¤ì •ë˜ì–´ìžˆì„ ë•Œ

---

# Why
ì—¬ê¸°ì„œ ì™œ cacheì— ë”í•´ ì—¬ëŸ¬ê°€ì§€ ìºì‹œì˜ ìƒíƒœë“¤ì´ í•„ìš”í•œì§€ì— ëŒ€í•œ ì˜ë¬¸ì´ ë“¤ìˆ˜ ìžˆìŠµë‹ˆë‹¤.
### 1. UXê°œì„ 
ìž˜ ì •ë¦¬í•´ì£¼ì‹  [ë¸”ë¡œê·¸](https://www.timegambit.com/blog/digging/react-query/03) ë•ë¶„ì— ì˜ë¬¸ì ì´ í•´ê²°ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸”ë¡œê·¸ì˜ ë‚´ìš©ì„ ì •ë¦¬í•˜ìžë©´ staleìƒíƒœë¥¼ í™œìš©í•œë‹¤ë©´ cacheë¥¼ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ëŠ” ê·¸ `ë¹„ì–´ìžˆëŠ” íƒ€ìž„`ì— loading íŽ˜ì—ì§€ê°€ ì•„ë‹Œ staleìƒíƒœ ë°ì´í„°ë¥¼ ë³´ì—¬ì¤Œìœ¼ë¡œì„œ ì‚¬ìš©ì„±ì„ ë†’ì´ëŠ” ëª©ì ì„ ë‹¬ì„±í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤. (ë§ˆì¹˜ ë°°í¬í• ë•Œ ë¸”ë£¨, ê·¸ë¦°ê³¼ ê°™ì€ ë„ˆë‚Œ!)

![mdx](https://velog.velcdn.com/images/boyeon_jeong/post/b76bffdc-dd3a-4109-a84b-d9695ac807c5/image.png)

![mdx](https://velog.velcdn.com/images/boyeon_jeong/post/2558ffe4-eba1-4d9d-babf-31d57088b5e1/image.png)

> ì´ë¯¸ì§€ ì¶œì²˜: https://www.timegambit.com/blog/digging/react-query/03

### 2. ë„¤íŠ¸ì›Œí¬ ë¹„ìš© ê°ì†Œ
ë§Œì•½ ì•„ëž˜ì™€ ê°™ì€ ê²½ìš°ì— react queryë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ë¶ˆí•„ìš”í•œ ë„¤íŠ¸ì›Œí¬ ë¹„ìš©ì´ ë°œìƒí•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

- apiì—ì„œ ë¶ˆëŸ¬ì˜¨ í›„ ë°”ë€Œì§€ ì•ŠëŠ” ë°ì´í„°
- post, put, deleteê°€ ë°œìƒí•œ ê²½ìš°ì—ë§Œ refetcing í•„ìš”
- ë³€ê²½ì‚¬í•­ì„ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ ì—†ì´ ì§ì ‘ ìˆ˜ì •í•´ì¤„ ìˆ˜ ìžˆëŠ” ê²½ìš°

ë”°ë¼ì„œ ì´ëŸ¬í•œ ê²½ìš° react queryì˜ ì—¬ëŸ¬ê°€ì§€ ì„¤ì •ì„ ì ì ˆížˆ ì‚¬ìš©í•´ì¤€ë‹¤ë©´ ë„¤íŠ¸ì›Œí¬ ë¹„ìš©ì„ í¬ê²Œ ê°ì†Œì‹œí‚¬ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

---

# How
### 1. Time ì„¤ì •
#### ðŸ“Œ staleTime
freshì—ì„œ staleë¡œ ê°€ëŠ” ì‹œê°„(api í˜¸ì¶œì„ nì´ˆ ìžˆë‹¤ê°€ ë‹¤ì‹œ í•´)

#### ðŸ“Œ cacheTime
inactiveê°€ ëœ í›„ ë©”ëª¨ë¦¬ì— ë‚¨ì•„ìžˆëŠ” ì‹œê°„(ì´ ì‹œê°„ì´ ì§€ë‚˜ë©´ ê°€ë¹„ì§€ ì»¬ë ‰í„°ì— ì˜í•´ ì œê±°ë¨)

### 2. default ì„¤ì •
QueryClientì˜ defaultOptionsì— staleTimeê³¼ cacheTime ì§€ì •í•´ì¤„ìˆ˜ ìžˆìŠµë‹ˆë‹¤.
```jsx
const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 1000 * 60,
      cacheTime: 1000 * 60 * 5,
    }
  },
});

const App = ({ Component, pageProps }: AppProps) => {
  return (
    <QueryClientProvider client={queryClient}>
      <Component {...pageProps} />
    </QueryClientProvider>
  );
};
```

### 3. ìƒí™©ë³„ ì„¤ì •

#### ðŸ“Œ apiì— í˜¸ì¶œì´ í•„ìš”í•˜ì§€ë§Œ ìµœì´ˆ í˜¸ì¶œ í›„ ë°”ë€Œì§€ ì•ŠëŠ” ì •ì  ë°ì´í„°
`staleTime`, `cacheTime`ì„ `Infinity`ë¡œ ì§€ì •

#### ðŸ“Œ post, put, delete í• ë•Œë§Œ ë‹¤ì‹œ í˜¸ì¶œì´ í•„ìš”í•œ ê²½ìš°
invalidateQueries() ë©”ì„œë“œ í™œìš©
invalidateQueries ë©”ì„œë“œëŠ” ìºì‹±ëœ ì¿¼ë¦¬ë¥¼ ë¬´íš¨í™”í•˜ëŠ” ë©”ì„œë“œìž…ë‹ˆë‹¤.

ì–´ë–¤ ìƒíƒœì˜ ë°ì´í„°ë¥¼ ë¬´íš¨í™” í• ê²ƒì¸ì§€ëŠ” refetchType(active, inactive, all, none)ìœ¼ë¡œ ì§€ì •í•´ì¤„ìˆ˜ ìžˆìŠµë‹ˆë‹¤. ê¸°ë³¸ê°’ì€ activeìž…ë‹ˆë‹¤.
```jsx
useMutation(api.commonService.postLikeData, {
  onSuccess: (data) => queryClient.invalidateQueries(['getVideoData', data.newsId]);
}
```




